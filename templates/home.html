{% extends 'base.html' %}

{% block title %}Hospital Management System{% endblock %}

{% block content %}
{%include 'admin/message_framework.html'%}
<div class="container-fluid" style="background-color: #0e2f44;">
  <div class="row">
    <div class="col-md-4 d-flex align-items-stretch">
      <div class=" text-light p-4">
        <div class=" text-light p-4">
          <h3 class="text-center">Our Services</h5>
            <p>Welcome to Our Hospital! We are dedicated to excellence in healthcare and strive to make a positive
              impact on the lives of our patients and the community.</p>
            <ul>
              <li>Primary Care</li>
              <li>Specialty Care</li>
              <li>Emergency Services</li>
              <li>Surgical Procedures</li>
              <li>Diagnostic Imaging</li>
              <li>Rehabilitation Services</li>
            </ul>
            <!-- Eye-catching appointment button -->
        </div>
        <div class="card bg-white">
          <button class="btn btn-primary btn-lg btn-block">Find available doctors </button>
          <!-- <button class="btn btn-success btn-lg btn-block">Take an Appointment to doctors </button> -->
        </div>



      </div>
    </div>
    <div class="col-md-4 d-flex align-items-stretch">
      <div class=" text-light p-4">
        <!-- Add your carousel code here -->
        <h3 class="text-center">Gallery</h3>
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="3"></li>
            <li data-target="#carouselExampleIndicators" data-slide-to="4"></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-150" src="https://cdn.pixabay.com/photo/2016/06/24/02/35/ehr-1476525_1280.png"
                width="800" height="400" alt="First slide">
              <div class="carousel-caption d-none d-md-block">
                <h3 class="text-dark">We take your data privacy</h5>
              </div>
            </div>
            <div class="carousel-item">

              <img class="d-block w-150" src="https://images.unsplash.com/photo-1579684453423-f84349ef60b0" width="800"
                height="400" alt="Third slide">
              <div class="carousel-caption d-none d-md-block">
                <h2 class=" text-light bg-dark">Diverse expertise and specialized doctors</h2>
              </div>
            </div>

            <div class="carousel-item">
              <img class="d-block w-150" src="https://plus.unsplash.com/premium_photo-1681967103563-871828436e1d"
                width="800" height="400" alt="Second slide">
              <div class="carousel-caption d-none d-md-block">
                <h2 class="text-light bg-dark">Patient comfort and ease are paramount</h2>
              </div>
            </div>
            <div class="carousel-item">
              <img class="d-block w-150" src="https://images.unsplash.com/photo-1538108149393-fbbd81895907" width="800"
                height="400" alt="Third slide">
              <div class="carousel-caption d-none d-md-block">
                <h2 class=" text-light bg-dark">Clean rooms and well-equipped</h2>
              </div>
            </div>
            <div class="carousel-item">
              <img class="d-block w-150" src="https://images.unsplash.com/photo-1619025873875-59dfdd2bbbd6" width="800"
                height="400" alt="Third slide">
              <div class="carousel-caption d-none d-md-block">
                <h2 class=" text-light bg-dark">24x7 Ambulance Service</h2>
              </div>
            </div>
          </div>
        </div>

        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>




    </div>
  </div>

</div>
</div>
<div>
  <input type="checkbox" id="check"> <label class="chat-btn" for="check"> <i class="fa fa-commenting-o comment"></i> <i
      class="fa fa-close close"></i> </label>
  <div class="wrapper">

    <div class="row ">
      <div class="col">
        <div class="card">
          <div class="card-header">Chat</div>

          <div id="message_log" class="card-body chat-messages">
            <!-- Chat messages will be displayed here -->
            <div class="message received">
              <img src="https://via.placeholder.com/40" class="avatar" alt="User 1">
              <div class="text">Hello!</div>
            </div>
            <div class="message sent">
              <div class="text">Hi
                hjgjybujvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvthere!
              </div>
              <img src="https://via.placeholder.com/40" class="avatar" alt="User 2">
            </div>
            <!-- Additional messages go here -->
          </div>

          <div class="card-footer">
            <div class="input-group">
              <input type="text" class="form-control" oninput="ontyping()" id="chat-message-input" placeholder="Type your message...">
              <div class="input-group-append">
                <button id="chat-message-submit" onclick="passAndClear();" class="btn btn-primary"
                  type="button">Send</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

</div>
{% endblock %}

{%block extra_css%}
<style>
  .chat-container {
    max-width: 600px;
    position: relative;
  }

  .chat-messages {
    overflow-y: scroll;
    max-height: 300px;
  }

  .message {
    display: flex;
    margin-bottom: 20px;
    clear: both;
    /* Clear float */
  }

  .message .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .message .text {
    padding: 10px;
    background-color: #f1f1f1;
    border-radius: 10px;
    max-width: 70%;
    /* Limiting message width */
    word-wrap: break-word;
    /* Wrap long words */
  }

  .message.sent {
    justify-content: flex-end;
    /* Move sender's message to the right */
  }

  .message.sent .text {
    background-color: #007bff;
    color: #fff;
    align-self: flex-end;
  }

  .message.received .text {
    background-color: #e9ecef;
    align-self: flex-start;
  }
</style>

<style>
  .chat-btn {
    position: absolute;
    right: 14px;
    bottom: 30px;
    cursor: pointer
  }

  .chat-btn .close {
    display: none
  }

  .chat-btn i {
    transition: all 0.9s ease
  }

  #check:checked~.chat-btn i {
    display: block;
    pointer-events: auto;
    transform: rotate(180deg)
  }

  #check:checked~.chat-btn .comment {
    display: none
  }

  .chat-btn i {
    font-size: 22px;
    color: #fff !important
  }

  .chat-btn {
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50px;
    background-color: blue;
    color: #fff;
    font-size: 22px;
    border: none
  }

  .wrapper {
    position: absolute;
    right: 20px;
    bottom: 100px;
    width: 300px;
    background-color: #fff;
    border-radius: 5px;
    opacity: 0;
    transition: all 0.4s;

  }

  #check:checked~.wrapper {
    opacity: 1
  }

  .header {
    /* padding: 13px; */
    background-color: blue;
    border-radius: 5px 5px 0px 0px;
    margin-bottom: 10px;
    color: #fff
  }

  .chat-form {
    padding: 15px
  }

  .chat-form input,
  textarea,
  button {
    margin-bottom: 10px
  }

  .chat-form textarea {
    resize: none
  }

  .form-control:focus,
  .btn:focus {
    box-shadow: none
  }

  .btn,
  .btn:focus,
  .btn:hover {
    background-color: blue;
    border: blue
  }
</style>
{%endblock%}

{%block extra_js%}
<script>
  // const roomName = JSON.parse(document.getElementById('room-name').textContent);
  const roomName = "{{room_name}}";

  const chatSocket = new WebSocket(
    'ws://'
    + window.location.host
    + '/ws/chat/'
    + roomName
    + '/'
  );

  console.log(chatSocket)

  chatSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    console.log("data_get:",data)
    // document.querySelector('#chat-log').value += (data.message + '\n');
    var message = data.message
    // 
    // Select all elements with the class 'msg_cotainer_send'
    var messageElements = document.querySelectorAll('.sent');

    // Check if any elements were found
    if (messageElements.length > 0) {
      // Get the last element from the NodeList
      var lastMessageElement = messageElements[messageElements.length - 1];

      // Get the text content of the last message
      var lastMessageText = lastMessageElement.textContent.trim();

            if (lastMessageText == message) {
              console.log("receive message:",message)
              return
            }
            else {
              

    var newMessage = document.createElement('div');
    newMessage.classList.add('message', 'received');
    var htmlMessage = ` <img src="https://via.placeholder.com/40" class="avatar" alt="User 1">
                 <div class="text">${message}</div>
                            `;
    newMessage.innerHTML = htmlMessage;
    var messageLog = document.getElementById('message_log');
    // 
    

    // Append the new message to the message log
    messageLog.appendChild(newMessage);

    messageLog.scrollTop = messageLog.scrollHeight;

            }
        } 
    
    else {
      console.log("No messages found.");
    }










  };

  chatSocket.onclose = function (e) {
    console.error('Chat socket closed unexpectedly');
  };


  function passAndClear() {
    // Get the input value
    const message = document.getElementById("chat-message-input").value;

    // Clear the input field
    document.getElementById("chat-message-input").value = '';


    if (message.trim() === "") {
      return; // Exit the function if the message is empty
    }



    chatSocket.send(JSON.stringify({
                "action" : "send.message",
                "message" :message.trim() ,
                "sender":roomName,
            }));


    var newMessage = document.createElement('div');
    newMessage.classList.add('message', 'sent');
    var htmlMessage = `
          <div class="text">${message}</strong></div>
                <img src="https://via.placeholder.com/40" class="avatar" alt="User 2">
                            `;

    newMessage.innerHTML = htmlMessage;
    var messageLog = document.getElementById('message_log');

    // Append the new message to the message log
    messageLog.appendChild(newMessage);

    messageLog.scrollTop = messageLog.scrollHeight;

  }

  function ontyping() {
  let message = document.getElementById("chat-message-input").value;
  
  if (message.trim() === "") {
      return; // Exit the function if the message is empty
    }

    chatSocket.send(JSON.stringify({
                "action":"type.message",
                'sender':roomName}  
          ));
  

}
</script>
{%endblock%}